<%= form_with(model: property, local: true, html: { multipart: true, class: "space-y-8 bg-white p-8 rounded-2xl shadow-xl max-w-4xl mx-auto" }) do |form| %>
  <% if property.errors.any? %>
    <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded">
      <p class="font-bold">There were errors with your submission:</p>
      <ul class="list-disc list-inside mt-2">
        <% property.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <%= form.hidden_field :user_id, value: current_user.id %>

    <div>
      <%= form.label :title, class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= form.text_field :title, class: "w-full border-gray-300 rounded-md shadow-sm p-2" %>
    </div>

    <div class="md:col-span-2">
      <%= form.label :description, class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= form.text_area :description, rows: 4, class: "w-full border-gray-300 rounded-md shadow-sm p-2" %>
    </div>

    <!-- Dropdown Fields -->
    <div>
      <%= form.label :property_type, class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= form.select :property_type, ['Residential', 'Commercial', 'Industrial', 'Disputed', 'Heritage'], prompt: "Select Property Type", class: "w-full border-gray-300 rounded-md shadow-sm p-2" %>
    </div>

    <div>
      <%= form.label :subtype, class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= form.select :subtype, ['Apartment', 'Villa', 'Plot', 'Office', 'Warehouse', 'Other'], prompt: "Select Subtype", class: "w-full border-gray-300 rounded-md shadow-sm p-2" %>
    </div>

    <div>
      <%= form.label :location, class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= form.text_field :location, class: "w-full border-gray-300 rounded-md shadow-sm p-2" %>
    </div>

    <div>
      <%= form.label :price, class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= form.number_field :price, step: 10000, class: "w-full border-gray-300 rounded-md shadow-sm p-2" %>
    </div>

    <div>
      <%= form.label :dispute_status, class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= form.select :dispute_status, ['Clear', 'Disputed', 'Under Litigation', 'Not Applicable'], prompt: "Select Dispute Status", class: "w-full border-gray-300 rounded-md shadow-sm p-2" %>
    </div>

    <div class="md:col-span-2">
      <%= form.label :dispute_summary, class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= form.text_area :dispute_summary, rows: 2, class: "w-full border-gray-300 rounded-md shadow-sm p-2" %>
    </div>

    <div>
      <%= form.label :ownership_type, class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= form.select :ownership_type, ['Freehold', 'Leasehold', 'Government', 'Cooperative', 'Other'], prompt: "Select Ownership Type", class: "w-full border-gray-300 rounded-md shadow-sm p-2" %>
    </div>

    <div>
      <%= form.label :total_area, class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= form.text_field :total_area, class: "w-full border-gray-300 rounded-md shadow-sm p-2" %>
    </div>

    <div>
      <%= form.label :jamabandi_year, class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= form.select :jamabandi_year, (2020..2025).to_a.map(&:to_s), prompt: "Select Jamabandi Year", class: "w-full border-gray-300 rounded-md shadow-sm p-2" %>
    </div>

    <% if current_user.admin? %>
      <div>
        <%= form.label :status, class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= form.select :status, ['available', 'sold', 'pending'], prompt: "Select status", class: "w-full border-gray-300 rounded-md shadow-sm p-2" %>
      </div>

      <div class="flex items-center space-x-2 mt-6">
        <%= form.check_box :approved, class: "h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded" %>
        <%= form.label :approved, class: "text-sm font-medium text-gray-700" %>
      </div>
    <% end %>
  </div>

  <!-- Images Section -->
  <div class="pt-8 border-t border-gray-200">
    <h3 class="text-xl font-semibold text-gray-800 mb-6">Images</h3>

    <% [["Main Image URL", :main_image_url], ["Main Image File", :main_image], ["Thumbnail URL", :thumbnail_url], ["Thumbnail File", :thumbnail]].each do |label_text, field| %>
      <div class="mb-4">
        <%= form.label field, label_text, class: "block text-sm font-medium text-gray-700 mb-1" %>
        <% if property.persisted? && field.to_s.include?("image") && property.send(field.to_s.gsub("_file", "").to_sym).respond_to?(:attached?) && property.send(field.to_s.gsub("_file", "").to_sym).attached? %>
          <div class="mb-2">
            <%= image_tag url_for(property.send(field.to_s.gsub("_file", "").to_sym)), class: "h-24 object-cover rounded shadow" %>
          </div>
        <% end %>
        <%= field.to_s.include?("url") ? form.text_field(field, class: "w-full border-gray-300 rounded-md shadow-sm p-2") : form.file_field(field, class: "w-full") %>
      </div>
    <% end %>

    <div class="mb-4">
      <%= form.label :images, "Gallery Images", class: "block text-sm font-medium text-gray-700 mb-1" %>
      <% if property.persisted? && property.images.attached? %>
        <div class="flex flex-wrap gap-3 mb-2">
          <% property.images.each do |img| %>
            <img src="<%= url_for(img) %>" class="h-20 w-20 object-cover rounded shadow" />
          <% end %>
        </div>
      <% end %>
      <%= form.file_field :images, multiple: true, class: "w-full" %>
    </div>
  </div>

  <!-- Documents Section -->
  <div class="pt-8 border-t border-gray-200">
    <h3 class="text-xl font-semibold text-gray-800 mb-6">Documents</h3>

    <% {
      title_document_files: "Title Documents",
      mutation_document_files: "Mutation Documents",
      aksfard_document_files: "Aksfard Documents",
      court_case_document_files: "Court Case Documents",
      supporting_documents: "Supporting Documents"
    }.each do |field, label| %>
      <div class="mb-4">
        <%= form.label field, label, class: "block text-sm font-medium text-gray-700 mb-1" %>
        <% if property.persisted? && property.send(field).attached? %>
          <ul class="list-disc list-inside text-sm text-blue-700 mb-2">
            <% property.send(field).each do |doc| %>
              <li>
                <%= link_to doc.filename.to_s, url_for(doc), target: "_blank", class: "hover:underline" %>
              </li>
            <% end %>
          </ul>
        <% end %>
        <%= form.file_field field, multiple: true, class: "w-full" %>
      </div>
    <% end %>
  </div>

  <!-- Submit Button -->
  <div class="pt-8 border-t border-gray-200 text-center">
    <%= form.submit "#{property.persisted? ? 'Update' : 'Submit'} Property", class: "bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-6 rounded-full transition" %>
  </div>
<% end %>
